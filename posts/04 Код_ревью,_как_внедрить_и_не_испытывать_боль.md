---
title: Код ревью, как внедрить и не испытывать боль
description: Статья о плюсах внедрения код-ревью на проекте и советы как его лучше реализовать.
date: 2021-08-18
tags:
- Тех
- Процесс
  layout: layouts/post.njk
  permalink: "/how-to-update-preview-in-telegram/"
  image: https://sun9-43.userapi.com/impg/a13St1Phhsc-Gak52w_8nmUH5nAJcyAiaZ5OTQ/hX97JVazcLw.jpg?size=640x360&quality=96&sign=b2646a6194c54f1bf3a88ebf32ec63e8&type=album
---
## Что это?

Основные понятия:
[Код ревью (code review)](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80_%D0%BA%D0%BE%D0%B4%D0%B0) - это часть процесса разработки продукта. В нем есть следующие участники:

- Автор - разработчик, который написал код. При этом любого объема, содержания и качества. Это может быть багфикс, фича
- Ревьюер - человек, который проверяет написанное, пишет замечания и возвращает код на доработку.
## Зачем нужен код ревью?

Если вы работаете в продуктовой компании, то жизненный цикл почти каждого продукта будет соответствовать [принципу Парето](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%9F%D0%B0%D1%80%D0%B5%D1%82%D0%BE):

- 20% времени мы пишем новый код.
- 80% времени поддерживаем старый. Поддержка в себя включает фиксы багов, обновление кодовой базы (переезд на новые библиотеки например).

Во время поддержки мы хотим чтобы все разработчики как можно быстрее вникали в то, что написано. Для этого есть много способов, все они прекрасны и хорошо работают вместе.

Способы иметь хорошо поддерживаемый код:

- Покрытие тестами
- Ведение документации
- Код ревью

Все эти способы нужно уметь готовить. Есть тесты, которые только мешают, бесполезная документация и бессмысленный код ревью.
Что нам даёт код ревью:
➕ Проверку кода по многим критериям (неочевидные места, композиция, недостатки комментариев)
➕ Шаринг знаний о проекте. Не только 1 человек знает, что там пишется в другом проекте или части проекта, а все.
➕ Шаринг знаний о технологиях. Вы можете заметить, что кто-то напилил своих костылей, а похожая проблема в проекте уже решалась.
➕ Сотрудники быстрее онбордятся. Это нормально получать много замечаний в самом начале, постепенно их станет меньше, по мере погружения в проект.

Способов поддерживать код «качественным» есть много, но все их нужно правильно готовить. Нужно уметь писать тесты, нужно уметь писать документацию и нужно правильно организовать код ревью.

## Советы по организации

❌ Ревьюить только джунов и новых коллег
✅ Проводить ревью для всех и всеми

В коде лидов тоже могут быть ошибки. Джуниор разработчики могут подсмотреть какие-то практики, методы, способы из кода сеньора. Вместо того, чтобы собирать их в переговорках - давайте читать новый код и задавать вопросы.

Если ревью проходят не все, то в вашей команде это будет восприниматься как источник недоверия. Такую атмосферу следует искоренять.

![У нас все делают всё](https://paper-attachments.dropbox.com/s_2F609ACD82D75F4A8DC0E50DFFEE216D00CD5915FEFA922E5E1FCCFDA5A0BE1A_1629225737873_++.png)


❌ Обсуждать на код ревью стиль
✅ Настроить у себя на проекте инструменты, которые автоматически будут исправлять стиль перед коммитом

В JS это eslint и prettier. Не тратьте время своё и коллег на вкусовщину. Договоритесь заранее и пропишите правила. В случае разногласий голосуйте.

![Чувство стиля](https://paper-attachments.dropbox.com/s_2F609ACD82D75F4A8DC0E50DFFEE216D00CD5915FEFA922E5E1FCCFDA5A0BE1A_1629225760479_+.jpeg)


❌ Ревьюер запускает руками билд или проверяет код на баги.
✅ Автор сам несет ответственность за поставленный код.

Настройте CI/CD инструменты и проверяйте билд на сервере. Автор же проверяет, чтобы все работало как нужно, фича соответствовала требованиям заказчика и в принципе работала.

❌ Ревьюер не читает код
✅ Обращать внимание на композицию, магические переменные, оптимизацию (там где это имеет смысл)

Ваша задача, как ревьюера, получить такой код, который в случае болезни разработчика вы завтра будете поддерживать и не потонете. Задача автора - писать код, который как будто будет поддерживать маньяк, который знает где живет автор.

![Если я не буду это замечать, оно уйдет](https://paper-attachments.dropbox.com/s_2F609ACD82D75F4A8DC0E50DFFEE216D00CD5915FEFA922E5E1FCCFDA5A0BE1A_1629225778862_4b6799e20a115d32aa3ae2439679c79d.png)


❌ Агрессия, негатив, «токсичное» поведение в комментах
✅ Старайтесь отмечать не только негативные стороны, но и хвалить за позитивные.

Примеры плохих комментов:

> «это плохой код», «перепиши»

Примеры хороших комментов:

> «Давай попробуем сделать …» «Может попробуем вынести…»

То же самое касается и ответов на комменты автором. Если автор не согласен, то необходимо объяснять с помощью аргументов, а не фраз в духе "я так делать не буду". Если не получается текстом, иногда проще подойти или сделать короткий созвон, чтобы понять друг друга.

![Ревью показало, что вы сладкая булочка](https://paper-attachments.dropbox.com/s_2F609ACD82D75F4A8DC0E50DFFEE216D00CD5915FEFA922E5E1FCCFDA5A0BE1A_1629225808297_-----5188107.jpeg)


❌ Оставлять больше 50 комментариев
✅ Оставлять до 50 комментариев

Если комментариев накапливается очень много, то у вас:

- Или не настроены линтеры, и вы не определились со стилем, поэтому комменты о вкусовщине
- Или переделать в коде нужно многое

Во втором случае оставьте 1 комментарий с рекомендациями как и что нужно переписать. В таком случае лучше закрыть мердж реквест, переписать код и открыть новый.

Если код будет переписан полностью, отследить изменение по комментариям практически невозможно и они не имеют смысла. Авторы тоже должны это понимать и следить, чтобы всем было комфортно.

❌ Все комментарии обязательны к исправлению
✅ Помечать необязательные комментарии

В замечаниях могут быть необязательные правки - например вкусовщина, или замечания, требующие большую переработку кода. Такие комментарии обязательно помечайте. Если автор не готов их пофиксить сразу, то:

- Когда правка относится к вкусовщине - забить
- Когда правка большая - завести под нее отдельную таску.

❌ Пытаться объяснить алгоритмы на словах
✅ Написать пример псевдокода

Особенно актуально, если автор не совсем понимает что от него хочет ревьюер. Не нужно полностью писать реализацию. Напишите небольшой пример псевдокода. Gitlab, github и bitbucket позволяют вставлять в комментарии разметку markdown. Ваш код будет хорошо отформатирован и более понятен, чем длинная цепочка комментов.

![Псевдокода не будет](https://paper-attachments.dropbox.com/s_2F609ACD82D75F4A8DC0E50DFFEE216D00CD5915FEFA922E5E1FCCFDA5A0BE1A_1629225834194_++.jpeg)



## В заключении

Можно бесконечно о необходимости код ревью на проекте. У подхода найдутся как последователи, так и противники, но я бы всегда хотел, чтобы мой код проходил ревью. Это всегда помогает в развитии (либо помогает понять, что в данной команде вы работать не хотите 🙂).


## Почитать

По теме рекомендую почитать:
[Статья How to Do Code Reviews Like a Human](https://mtlynch.io/human-code-reviews-1/)

